<html>
  <head>
    <script src="https://api.mqcdn.com/sdk/mapquest-js/v1.1.0/mapquest.js"></script>
    <link type="text/css" rel="stylesheet" href="https://api.mqcdn.com/sdk/mapquest-js/v1.1.0/mapquest.css"/>


    <!-- Vizuly specific style sheets -->
    <link rel="stylesheet" href="lib/styles/vizuly.css">
    <link rel="stylesheet" href="lib/styles/vizuly_radial_progress.css">

    <script src="lib/d3.min.js"></script>
    <script src="lib/vizuly_core.min.js"></script>
	<script src="lib/vizuly_radialprogress.min.js"></script>

    <script type="text/javascript">

      window.onload = function() {
        L.mapquest.key = 'tzjnBtklfROgvtSziM4XfidcYdriKBId';

		var locs = ['Portland, OR', 'Flagstaff, AZ', 'Denver, CO'];
		var vals = [80, 48, 90];
		var markerWidth = 64;

        L.mapquest.geocoding().geocode(locs, createMap);

        function createMap(error, response) {
          var map = L.mapquest.map('map', {
            center: [0, 0],
            layers: L.mapquest.tileLayer('map'),
            zoom: 14
          });

		  var featureGroup = generateMarkersFeatureGroup(response);

          // Add markers to the map and zoom to the features
          featureGroup.addTo(map);
          map.fitBounds(featureGroup.getBounds());

          for (var i = 0; i < 3; i++) {
			  var markerNode = document.getElementById("marker" + i);
			  var vizMarker = vizuly.viz.radial_progress(markerNode);
			  vizMarker.data(vals[i])
				  .min(0)
				  .max(100)
				  .capRadius(1)
				  .startAngle(250)
				  .endAngle(110)
				  .arcThickness(.15);
			  var theme = vizuly.theme.radial_progress(vizMarker).skin(vizuly.skin.RADIAL_PROGRESS_ALERT);
			  vizMarker.width(markerWidth).height(markerWidth).radius(markerWidth/2.2).update();
		  }
        }

        function generateMarkersFeatureGroup(response) {
          var group = [];

          for (var i = 0; i < response.results.length; i++) {
            var location = response.results[i].locations[0];
            var locationLatLng = location.latLng;

			var marker = L.marker(locationLatLng, {icon: L.divIcon({html: '<div id="marker' + i + '"></div>', iconSize: [markerWidth, markerWidth]})})
              .bindPopup(location.adminArea5 + ', ' + location.adminArea3);

            group.push(marker);
          }
          return L.featureGroup(group);
        }
      }
    </script>
	<style type="text/css">
		.marker {
			background-color: gray;
		}

		.leaflet-div-icon {
			border: none;
			background: none;
		}

		.vz-radial_progress-label {
			display: none;
		}
	</style>
  </head>

  <body style="border: 0; margin: 0;">
    <div id="map" style="width: 100%; height: 530px;"></div>
  </body>
</html>
